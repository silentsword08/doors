<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uno</title>
    <style>
        body {
            background-color: rgb(50, 50, 60);
            margin: 0px;
            padding: 0px;
        }
        h1 {
            background-color: rgb(30, 30, 40);
            height: 50px;
            margin: 0px;
            padding: 0px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .text {
            color: white;
            text-shadow: 2px 2px 2px rgba(0, 0, 0, 1);
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, sans-serif;
            text-align: center;
            font-size: 35px;
        }
        .rule {
            background-color: rgb(250, 50, 50);
            height: 160px; width: 75%;
            margin-left: 12.5%; margin-top: 2%;
            border-radius: 10px;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: top;
            flex-direction: column;
        }
        .start-text {
            font-size: 50px;
            /* width: 200px; */
            height: 100px;
            margin-left: auto; margin-top: 0%;
            text-align: center;
            /* background-color: blue; */
        }
        .rule-header {
            background-color: white;
            height: 35%; width: calc(100% - 10px);
            border-radius: 10px;
            border: 5px solid red;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .rule-header-text {
            /* font-size: 25px; */
            /* background-color: blue; */
        }
        .rule-desc {
            margin-top: 2%;
            /* background-color: green; */
        }
    </style>
    <body>
        <h1>
            <span class = "text">Uno</span>
        </h1>

        <div class = "start-text">
            <span class = "text">Press space to generate a rule</span>
        </div>
            
        <div class = "rule">
            <div class = "rule-header">
                <span class = "text rule-header-text" style = "color: black; text-shadow: 0px 0px 0px rgba(0, 0, 0, 0);"></span>
            </div>
            <span class = "rule-desc text" style = "text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.5)"></span>
        </div>

        <script>
            let ogRuleBox = document.querySelector('.rule');
            ogRuleBox.style.visibility = "hidden";
            ogRuleBox.style.position = "absolute";

            let colors = ["red","blue","green","yellow"]
            let numbers = [
              "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"
            ];
            let specials = ["skip", "reverse", "+2"]

            let allRules = [
                // [Title, Desc, Intensity]
                ["Skip you, skip you, skip you!", "Skip cards can be played on any number card.", "2"],
                ["Back to me", "Reverse cards can be played on any number card.", "2"],
                ["One card?!", "/number cards act as a +1 card.", "1"],
                ["Rainbow /number", "Any color number card can be played on a /number card", "1"],
                ["So close", "A /number card can be played on a number card one higher or lower.", "1"],
                ["I can show you the world", "All /color cards in players' hands must be visible to every other player at all times.", "2"],
                ["Gimme that color", "Every time a player draws a card, they must announce the card's color.", "3"],
                ["Gimme that number", "Every time a player draws a card, they must announce the card's number.", "2"],
                ["/color card hog!","Every time a /color card is played, the next player must add it to their hand.","3"],
                ["\"UNO!\"","Calling out a player for not saying \"Uno\" before the next card is played gives them four cards instead of 2.","1"],
                ["Shhhhh!","Starting when the next card is played, players must draw a card for each word they say aloud.","2"],
                ["Double trouble","The numbers of cards to draw from +2 cards or wild +4 cards are doubled.","3"],
                ["So many choices","When a player plays a wild card or a wild +4 card, the next player decides the color instead.","1"],
                ["Because 7 8 /number!","/number cards cannot be played.","2"],
                ["Karma","When a player plays a /special card, its effect applies to them instead of the next player.","2"],
                ["Pay attention","When a player plays a card that cannot be played, they must draw ten cards (except if another rule forces them to).","2"],
                ["Not a rule follower","When a player draws a card, they may play it even if they are not allowed to.","2"],
                ["","",""]
            ]

            function capitalize(str) {
                if (!str) return str;
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            let pastRuleTitles = [];

            function newRuleBox(title = "", desc = "", intensity = 1) {
                let box = ogRuleBox.cloneNode(true);

                document.body.appendChild(box);
                box.style.visibility = "visible";
                box.style.position = "relative";

                let ruleHeader = box.querySelector(".rule-header");
                let titleText = box.querySelector(".rule-header-text");
                let descText = box.querySelector(".rule-desc");

                let randColor = colors[Math.round(Math.random() * (colors.length - 1))];
                let randNumber = numbers[Math.round(Math.random() * (numbers.length - 1))];
                let randSpecial = specials[Math.round(Math.random() * (specials - 1))];

                let newTitle = capitalize(title
                    .replace("/color", randColor)
                    .replace("/number", randNumber)
                    .replace("/special", randSpecial));
                let newDesc = capitalize(desc
                    .replace("/color", randColor)
                    .replace("/number", randNumber)
                    .replace("/special", randSpecial));

                titleText.textContent = newTitle;
                descText.textContent = newDesc;

                let color = ""
                
                if (intensity == 1) {
                    color = "chartreuse";
                } else if (intensity == 2) {
                    color = "gold";
                } else if (intensity == 3) {
                    color = "red";
                }
                
                box.style.backgroundColor = color;
                ruleHeader.style.borderColor = color;

                pastRuleTitles.push(title);
                // console.log(pastRuleTitles);

                if (pastRuleTitles.length >= 5) {
                    pastRuleTitles.pop();
                }
            }

            function getRule() {
                let found = false;
                let rule = null
                
                while (!rule) {
                    let index = Math.round(Math.random() * (allRules.length - 1));
                    rule = allRules[index];

                    if (pastRuleTitles.length > 0) {
                        for (let pastRuleTitle of pastRuleTitles) {
                            if (rule[0] == pastRuleTitle) {
                                console.log(rule[0])
                                rule = null;
                                break;
                            }
                        }
                    }
                    
                }
                return rule;
            }

            document.addEventListener("keydown", function(event) {
                if (event.key == " ") {
                    let rules = document.querySelectorAll(".rule")
                    if (rules.length >= 3) {
                        rules[0].remove();
                    }
                    
                    if (document.querySelector(".start-text")) {
                        document.querySelector(".start-text").remove();
                    }

                    let randomRule = getRule();
                    newRuleBox(randomRule[0], randomRule[1], randomRule[2]);
                }
            })
        </script>
    </body>
    </head>
</html>
